<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes" />
	<title>Cosmos: The infographic book of space</title>
	<link rel="stylesheet" href="../style.css" />
	<style>
	/* CSS3 Animations */
	#space {
		width: 100%;
		height: 90%;
		position: absolute;
		left: 0px;
		right: 0px;
		top: 0px;
		bottom: 0px;
	}
	.middlebox {
		position: absolute;
		left: 2em;
		right: 2em;
		top: 2em;
		bottom: 2em;		
	}
	@media only screen and (max-width: 700px){
		.middlebox { left: 1em; bottom: 1em; top: 1em; right: 1em; }
	}
	.innerbox {
		position: absolute;
		left: 0em;
		right: 0em;
		top: 4.5em;
		bottom: 0em;		
	}
	.human {
		width: 0.6em;
		height: 0.6em;
		border-radius: 100%;
		position: absolute;
		left: 0px;
		top: 0px;
		margin-top: -0.3em;
		margin-left: -0.3em;
		-webkit-transition: left 2s, top 2s;
		transition: left 2s, top 2s;
		cursor: pointer;
		z-index: 1;
	}
	.inorbit { border: 0.4em solid white; margin-left: -0.5em; margin-top: -0.5em; }
	.human:hover, .human:focus {
		width: 1.4em;
		height: 1.4em;
		margin-top: -0.7em;
		margin-left: -0.7em;
		z-index: 10;
	    background-image: url('astronaut.png');
	    background-size: 40% 80%, auto;
	    background-repeat:no-repeat;
		background-position:center center;
	}
	.inorbit:focus, .inorbit:hover { margin-left: -1em; margin-top: -1em; }
	
	.astronaut { background-color: #00a2d3; }
	.cosmonaut { background-color: #f04031; }
	.taikonaut { background-color: #ffcb06; }
	.international { background-color: #67c18d; }
	.tourist { background-color: #662d8f; }
	.stripe { width: 100%; height: 4px; }
	</style>
	<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
	<script src="../infographics.js"></script>
	<script type="text/javascript">
	$(document).ready(function(){

		var astronauts;
		var xaxis;
		var yaxis;
		var cc = {'ABW':'Aruba','AFG':'Afghanistan','AGO':'Angola','AIA':'Anguilla','ALA':'&Aring;land Islands','ALB':'Albania','AND':'Andorra','ARE':'United Arab Emirates','ARG':'Argentina','ARM':'Armenia','ASM':'American Samoa','ATA':'Antarctica','ATF':'French Southern Territories','ATG':'Antigua and Barbuda','AUS':'Australia','AUT':'Austria','AZE':'Azerbaijan','BDI':'Burundi','BEL':'Belgium','BEN':'Benin','BES':'Bonaire, Sint Eustatius and Saba','BFA':'Burkina Faso','BGD':'Bangladesh','BGR':'Bulgaria','BHR':'Bahrain','BHS':'Bahamas','BIH':'Bosnia and Herzegovina','BLM':'Saint Barthélemy','BLR':'Belarus','BLZ':'Belize','BMU':'Bermuda','BOL':'Bolivia, Plurinational State of','BRA':'Brazil','BRB':'Barbados','BRN':'Brunei Darussalam','BTN':'Bhutan','BVT':'Bouvet Island','BWA':'Botswana','CAF':'Central African Republic','CAN':'Canada','CCK':'Cocos (Keeling) Islands','CHE':'Switzerland','CHL':'Chile','CHN':'China','CIV':'Côte d\'Ivoire','CMR':'Cameroon','COD':'Congo, the Democratic Republic of the','COG':'Congo','COK':'Cook Islands','COL':'Colombia','COM':'Comoros','CPV':'Cabo Verde','CRI':'Costa Rica','CUB':'Cuba','CUW':'Curaçao','CXR':'Christmas Island','CYM':'Cayman Islands','CYP':'Cyprus','CZE':'Czech Republic','DEU':'Germany','DJI':'Djibouti','DMA':'Dominica','DNK':'Denmark','DOM':'Dominican Republic','DZA':'Algeria','ECU':'Ecuador','EGY':'Egypt','ERI':'Eritrea','ESH':'Western Sahara','ESP':'Spain','EST':'Estonia','ETH':'Ethiopia','FIN':'Finland','FJI':'Fiji','FLK':'Falkland Islands (Malvinas)','FRA':'France','FRO':'Faroe Islands','FSM':'Micronesia, Federated States of','GAB':'Gabon','GBR':'United Kingdom','GEO':'Georgia','GGY':'Guernsey','GHA':'Ghana',	'GIB':'Gibraltar','GIN':'Guinea','GLP':'Guadeloupe','GMB':'Gambia','GNB':'Guinea-Bissau','GNQ':'Equatorial Guinea','GRC':'Greece','GRD':'Grenada','GRL':'Greenland','GTM':'Guatemala','GUF':'French Guiana','GUM':'Guam','GUY':'Guyana','HKG':'Hong Kong','HMD':'Heard Island and McDonald Islands','HND':'Honduras','HRV':'Croatia','HTI':'Haiti','HUN':'Hungary','IDN':'Indonesia','IMN':'Isle of Man','IND':'India','IOT':'British Indian Ocean Territory','IRL':'Ireland','IRN':'Iran, Islamic Republic of','IRQ':'Iraq','ISL':'Iceland','ISR':'Israel','ITA':'Italy','JAM':'Jamaica','JEY':'Jersey','JOR':'Jordan','JPN':'Japan','KAZ':'Kazakhstan','KEN':'Kenya','KGZ':'Kyrgyzstan','KHM':'Cambodia','KIR':'Kiribati','KNA':'Saint Kitts and Nevis','KOR':'Korea, Republic of','KWT':'Kuwait','LAO':'Lao People\'s Democratic Republic','LBN':'Lebanon','LBR':'Liberia','LBY':'Libya','LCA':'Saint Lucia','LIE':'Liechtenstein','LKA':'Sri Lanka','LSO':'Lesotho','LTU':'Lithuania','LUX':'Luxembourg','LVA':'Latvia','MAC':'Macao','MAF':'Saint Martin (French part)','MAR':'Morocco','MCO':'Monaco','MDA':'Moldova, Republic of','MDG':'Madagascar','MDV':'Maldives','MEX':'Mexico','MHL':'Marshall Islands','MKD':'Macedonia, the former Yugoslav Republic of','MLI':'Mali','MLT':'Malta','MMR':'Myanmar','MNE':'Montenegro','MNG':'Mongolia','MNP':'Northern Mariana Islands','MOZ':'Mozambique','MRT':'Mauritania','MSR':'Montserrat','MTQ':'Martinique','MUS':'Mauritius','MWI':'Malawi','MYS':'Malaysia','MYT':'Mayotte','NAM':'Namibia','NCL':'New Caledonia','NER':'Niger','NFK':'Norfolk Island','NGA':'Nigeria','NIC':'Nicaragua','NIU':'Niue',	'NLD':'Netherlands','NOR':'Norway','NPL':'Nepal','NRU':'Nauru','NZL':'New Zealand','OMN':'Oman','PAK':'Pakistan','PAN':'Panama','PCN':'Pitcairn','PER':'Peru','PHL':'Philippines','PLW':'Palau','PNG':'Papua New Guinea','POL':'Poland','PRI':'Puerto Rico','PRK':'Korea, Democratic People\'s Republic of','PRT':'Portugal','PRY':'Paraguay','PSE':'Palestine, State of','PYF':'French Polynesia','QAT':'Qatar','REU':'Réunion','ROU':'Romania','RUS':'Russian Federation','RWA':'Rwanda','SAU':'Saudi Arabia','SDN':'Sudan','SEN':'Senegal','SGP':'Singapore','SGS':'South Georgia and the South Sandwich Islands','SHN':'Saint Helena, Ascension and Tristan da Cunha','SJM':'Svalbard and Jan Mayen','SLB':'Solomon Islands','SLE':'Sierra Leone','SLV':'El Salvador','SMR':'San Marino','SOM':'Somalia','SPM':'Saint Pierre and Miquelon','SRB':'Serbia','SSD':'South Sudan','STP':'Sao Tome and Principe','SUR':'Suriname','SVK':'Slovakia','SVN':'Slovenia','SWE':'Sweden','SWZ':'Swaziland','SXM':'Sint Maarten (Dutch part)','SYC':'Seychelles','SYR':'Syrian Arab Republic','TCA':'Turks and Caicos Islands','TCD':'Chad','TGO':'Togo','THA':'Thailand','TJK':'Tajikistan','TKL':'Tokelau','TKM':'Turkmenistan','TLS':'Timor-Leste','TON':'Tonga','TTO':'Trinidad and Tobago','TUN':'Tunisia','TUR':'Turkey','TUV':'Tuvalu','TWN':'Taiwan, Province of China','TZA':'Tanzania, United Republic of','UGA':'Uganda','UKR':'Ukraine','UMI':'United States Minor Outlying Islands','URY':'Uruguay','USA':'United States','UZB':'Uzbekistan','VAT':'Holy See (Vatican City State)','VCT':'Saint Vincent and the Grenadines','VEN':'Venezuela, Bolivarian Republic of','VGB':'Virgin Islands, British','VIR':'Virgin Islands, U.S.','VNM':'Viet Nam','VUT':'Vanuatu','WLF':'Wallis and Futuna','WSM':'Samoa','YEM':'Yemen','ZAF':'South Africa','ZMB':'Zambia','ZWE':'Zimbabwe','URS':'Soviet Union','GDR':'East Germany','TCH':'Czechoslovakia'};

		loadDAT("data/processed/astronauts.tsv",parseAstronauts,{});

		function sortBy(i){
			yaxis = i;
			astronauts = astronauts.sort(function (a, b) {
				return a[i] > b[i] ? 1 : -1;
			});
		}

		function formatArray(str,lookup){
			// Split array
			var arr = str.split(/;/);
			str = "";
			for(var i = 0 ; i < arr.length; i++){
				if(str) str += ", ";
				if(lookup) str += lookup[arr[i]];
				else str += arr[i];
			}
			return str;
		}

		function drawAstronauts(){
			var output = "";
			for(var i = 0; i < astronauts.length; i++){
				output += '<a href="#" id="'+astronauts[i].id+'" class="human '+astronauts[i].category+''+(astronauts[i].inspaceasof != null ? ' inorbit' : '')+'" title="'+astronauts[i].name+'"><\/a>';
			}
			$('.innerbox').append(output);
			updateAstronauts();
		}

		$('#yaxis').on('change',function(){
			sortBy('name');
			sortBy($(this).val());
			updateAstronauts();
			$('.tooltip_close').trigger('click')
		});

		$('#xaxis').on('change',function(){
			xaxis = $(this).val();
			updateAstronauts();
			$('.tooltip_close').trigger('click')
		});

		function updateAstronauts(){

			var now = new Date();
			var wide = $(window).width()-parseInt($('#0').width());
			var tall = $(window).height()-parseInt($('#0').height());
			var dx = tall/astronauts.length;
			var xoff = 0;
			var good = 0;
			var mx_x = -1e100;
			var mn_x = 1e100;
			var mx_y = -1e100;
			var mn_y = 1e100;
			if(!xaxis) xaxis = "time_space_days";
			for(var i = 0; i < astronauts.length; i++){
				// Update time in space for astronauts currently in space
				if(astronauts[i].inspaceasof != null) astronauts[i].time_space_days = (astronauts[i].time_space_days_original + ((now-astronauts[i].inspaceasof)/(1000*86400))).toFixed(2);
				if(astronauts[i].time_space_days > 0){
					good++;
					if(astronauts[i][xaxis] > mx_x) mx_x = astronauts[i][xaxis];
					if(astronauts[i][xaxis] < mn_x) mn_x = astronauts[i][xaxis];
					if(astronauts[i][yaxis] > mx_y) mx_y = astronauts[i][yaxis];
					if(astronauts[i][yaxis] < mn_y) mn_y = astronauts[i][yaxis];
				}
			}
			var output = "";
			var dy = 1/good;
			for(var i = 0, j = 0; i < astronauts.length; i++){
				
				if(xaxis=="time_space_days" || xaxis=="longest_trip") x = (astronauts[i][xaxis] >= 0 ? (Math.log10(astronauts[i][xaxis])+1.1)/4 : 1);
				else x = (astronauts[i][xaxis]-mn_x)/(mx_x-mn_x);
				
				if(yaxis=="dob" || yaxis=="time_eva" || yaxis=="firstlaunch_age" || yaxis=="launches") y = (astronauts[i][yaxis]-mn_y)/(mx_y-mn_y);
				else if(yaxis=="longest_trip") y = (astronauts[i][yaxis] >= 0 ? (Math.log10(astronauts[i][yaxis])+1.1)/4 : 1);
				else y = j*dy;
				
				if(astronauts[i].time_space_days == 0){
					x = -100;
					$('#'+astronauts[i].id).remove();
				}else{
					j++;
					//output += astronauts[i].id+" ";
					$('#'+astronauts[i].id).css({'left':(100*x)+"%",'top':(100*y)+"%"});
				}
			}
		}
		
		function parseAstronauts(data,attrs){

			astronauts = CSV2JSON(data,[{'name':'name'},{'name':'country'},{'name':'gender'},{'name':'dob','format':'date'},{'name':'time_space_days','format':'number'},{'name':'time_space','format':'number'},{'name':'time_eva','format':'number'},{'name':'launches','format':'number'},{'name':'evas','format':'number'},{'name':'firstlaunch','format':'date'},{'name':'time_dilation','format':'number'},{'name':'firstlaunch_age','format':'number'},{'name':'qualifications','format':'string'},{'name':'missions','format':'string'},{'name':'longest_trip','format':'number'},{'name':'distance','format':'number'},{'name':'eva_string','format':'string'},{'name':'category','format':'string'},{'name':'file','format':'string'},{'name':'inspaceasof','format':'date'}]);

			// Assign each one an ID
			for(var i = 0; i < astronauts.length; i++){
				astronauts[i].id = i;
				// Keep a copy of the original number of days in space
				astronauts[i].time_space_days_original = astronauts[i].time_space_days;
			}

			drawAstronauts();
			
			tooltip({
				'elements':$('.human'),
				'html':function(){
					var id = parseInt($(this).attr('id'));
					for(var i = 0; i < astronauts.length; i++){ if(astronauts[i].id==id) break; }
					var a = astronauts[i];
					var text = '<div class="stripe '+a.category+'"><\/div><h3>'+a.name+'<\/h3><table>';
					text += '<tr><td>Gender:<\/td><td>'+a.gender+'<\/td><\/tr>';
					text += '<tr><td>Country:<\/td><td>'+formatArray(a.country,cc)+'<\/td><\/tr>';
					text += '<tr><td>Year of birth:<\/td><td>'+a.dob.getFullYear()+'<\/td><\/tr>';
					text += '<tr><td>Age at first launch:<\/td><td>'+a.firstlaunch_age+' years<\/td><\/tr>';
					text += '<tr><td>Launches:<\/td><td>'+a.launches+'<\/td><\/tr>';
					text += '<tr><td>Time in space:<\/td><td>'+a.time_space_days+' days<\/td><\/tr>';
					if(a.time_eva > 0) text += '<tr><td>Total EVA:<\/td><td>'+parseInt(a.eva_string.substr(0,a.eva_string.lastIndexOf(":")))+' hours '+parseInt(a.eva_string.substr(a.eva_string.lastIndexOf(":")+1))+' mins<\/td><\/tr>';
					text += '<tr><td>Missions:<\/td><td>'+formatArray(a.missions)+'<\/td><\/tr>';
					if(a.inspaceasof != null) text += '<tr><td>Notes:<\/td><td>Currently in space<\/td><\/tr>';
					text += '<\/table>';
					text += '<a href="https://github.com/cosmos-book/cosmos-book.github.io/tree/master/humanspaceflight/data/'+a.file+'" class="repo">data file<\/a>';
					return text;
				}
			});
		}
	})
	</script>
</head>
<body class="EXP">

<div class="outerbox">
	<div class="middlebox">
		<h1>Human spaceflight</h1>
		<form>
			<label for="yaxis">Vertical</label>
			<select id="yaxis">
				<option value="name" selected="selected">Alphabetical</option>
				<option value="dob">Date-of-birth</option>
				<option value="time_eva">EVA duration</option>
				<option value="firstlaunch_age">Age at first launch</option>
				<option value="country">Country</option>
				<option value="launches">Launches</option>
				<option value="longest_trip">Longest individual trip</option>
				<option value="gender">Gender</option>
			</select>
			<label for="xaxis">Horizontal</label>
			<select id="xaxis">
				<option value="time_space_days" selected="selected">Total time in space</option>
				<option value="dob">Date-of-birth</option>
				<option value="time_eva">EVA duration</option>
				<option value="firstlaunch_age">Age at first launch</option>
				<option value="launches">Launches</option>
				<option value="longest_trip">Longest individual trip</option>
			</select>
		</form>
		<div class="innerbox"></div>
	</div>
</div>

</body>
</html>